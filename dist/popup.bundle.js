(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(t,n,o){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,"string");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}var c;function l(e){if($("#chkAutoScroll").iCheck("update")[0].checked)if(e){var t=e.closest("tr");t?t.scrollIntoView({behavior:"smooth",block:"center"}):console.log("The parent row does not exist.")}else console.log("The specified cell does not exist.")}function s(){return document.body.classList.contains("dark-mode")}function d(e,t,n,o){for(var a=document.querySelector(".htCore").querySelectorAll("tbody tr"),r=0;r<a.length;r++){var i=a[r],c=i.querySelector("td:nth-child(2)");if(c&&c.textContent.trim()===e){var s=i.querySelector("td:nth-child(4)");if(l(s),s)return s.textContent=t,void(s.style.color=o)}}}function u(e){$.confirm.defaults=r(r({},$.confirm.defaults),{},e?{theme:"dark",backgroundDismiss:"dark",animation:"scale",closeAnimation:"scale",animateFromElement:!1,boxWidth:"30%",useBootstrap:!1,onOpen:function(){this.$body.addClass("dark-mode")}}:{theme:"light",backgroundDismiss:!0,animation:"scale",closeAnimation:"scale",animateFromElement:!1,boxWidth:"30%",useBootstrap:!1,onOpen:function(){this.$body.removeClass("dark-mode")}})}function h(){var e=document.body;e.classList.toggle("dark-mode");var t=e.classList.contains("dark-mode");localStorage.setItem("darkMode",t),document.getElementById("checkbox").checked=t,t?$("#imgBackground").hide():$("#imgBackground").show(),u(t),m(t)}function m(e){var t=document.getElementById("emojiPicker");e?t.classList.add("dark-mode"):t.classList.remove("dark-mode")}toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"3000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},$((function(){$(".multiple-select").multipleSelect()})),document.addEventListener("DOMContentLoaded",(function(){var e,o;document.getElementById("checkbox").addEventListener("change",h),setTimeout((function(){chrome.runtime.sendMessage({task:"COPY_COOKIE"})}),5e3),chrome.storage.local.get(["introShown"],(function(e){e.introShown||(introJs().setOptions({nextLabel:"Tiếp",prevLabel:"Quay lại",doneLabel:"Hoàn tất",steps:[{intro:"Chào bạn, Zalo Marketing Pro"},{element:document.querySelector(".white-preview"),intro:"Chuyển chế độ sáng/tối."},{element:document.querySelector("#divAvatar"),intro:"Bấm vào đây để quản lý nhiều tài khoản zalo."},{element:document.querySelector("#txtTaiKhoanEmail"),intro:"Bấm vào đây xem thông tin gói cước sử dụng."},{intro:"Bắt đầu sử dụng."}]}).start(),chrome.storage.local.set({introShown:!0}))})),e=document.body,o=document.getElementById("checkbox"),"true"===localStorage.getItem("darkMode")?(e.classList.add("dark-mode"),o.checked=!0,u(!0),m(!0)):(e.classList.remove("dark-mode"),o.checked=!1,u(!1),m(!1)),s?$("#imgBackground").hide():$("#imgBackground").show(),chrome.storage.local.get(["userEmail","loginExpiration"],(function(e){var t=e.userEmail;$.ajax({url:"https://key.laptrinhvb.net/api/get_user_info",method:"POST",data:{email:t,app_id:1}}).done((function(e){row_update_id=e.id,e.days_remaining;var t=chrome.runtime.getManifest().version,n="".concat(t);"Vĩnh viễn"===e.days_remaining?$("#txtThoiHan").html("Thời hạn: <span style='color: green; font-weight: bold;'>".concat(e.days_remaining,".</span> | ").concat(n)):Number(e.days_remaining)<=3?$("#txtThoiHan").html("Sắp hết hạn: còn <span style='color: red; font-weight: bold;'>".concat(e.days_remaining," ngày.</span> | ").concat(n)):$("#txtThoiHan").html("Thời hạn: <span style='color: green; font-weight: bold;'>".concat(e.days_remaining," ngày.</span> | ").concat(n))})).fail((function(){console.error("Lỗi khi tải thông tin người dùng.")}))})),chrome.storage.sync.get(["running"],(function(e){var t=e.running;function n(e){e?(document.body.classList.add("dark-mode"),a.checked=!0):(document.body.classList.remove("dark-mode"),a.checked=!1)}console.log({running:t});var o=t+""!="false",a=document.querySelector("#checkbox");n(o),a.addEventListener("change",(function(){o=a.checked,chrome.storage.sync.set({running:o},(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log({err:t})})),n(o)}))}));var a=document.getElementById("txtMessage"),r=document.getElementById("btnSend"),i=document.getElementById("btnShareAllFen"),l=document.getElementById("btnStop"),g=document.getElementById("btnReset"),p=document.getElementById("btnXoaCache"),f=document.getElementById("btnLogout"),b=document.getElementById("btnXuatExcel"),y=document.getElementById("btnXuatTxt"),v=document.getElementById("btnNhapDienThoai"),x=document.getElementById("btnImportExcel"),k=document.getElementById("btnXuatVcard"),E=document.getElementById("btnXuatDanhBa"),C=document.getElementById("btnOpenImage"),S=document.getElementById("fileDanhSach"),w=document.getElementById("fileMedia"),L=document.getElementById("emojiButton"),I=document.getElementById("emojiPicker"),_=document.getElementById("txtMessage"),T=document.getElementById("clearIcon"),A=document.getElementById("charCount"),B=document.getElementById("divAvatar");chrome.storage.local.get(["userEmail","loginExpiration"],(function(e){$("#txtTaiKhoanEmail").text(e.userEmail)}));var N=function(){var e=_.value.length;A.textContent="".concat(e," ký tự")};function O(e){var t=e.replace(/[\s+]/g,"");return/^(0|\+?84)?(3|5|7|8|9)(\d{8})$/.test(t)}_.addEventListener("input",(function(){_.value.length>0?(T.classList.remove("hidden"),A.classList.remove("hidden")):(T.classList.add("hidden"),A.classList.add("hidden")),N()})),T.addEventListener("click",(function(){_.value="",T.classList.add("hidden"),A.classList.add("hidden"),_.focus(),N()})),N();var D=!1,M="";function R(e){var t,o,a=(t=e.split("-"),o=3,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,a,r,i,c=[],l=!0,s=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=r.call(n)).done)&&(c.push(o.value),c.length!==t);l=!0);}catch(e){s=!0,a=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return c}}(t,o)||n(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=a[0],i=a[1],c=a[2];return"".concat(c,"/").concat(i,"/").concat(r)}function P(){chrome.storage.local.get({cookies:[]},(function(e){var t=e.cookies,n=document.getElementById("tableContainer");if(0!==t.length){var o='<table style="border: 1px solid #ddd;" class="table table-striped table-bordered  w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400  w-screen"><thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 sticky top-0"><tr class="bg-white border dark:bg-gray-300 darkborder-gray-700 hover:bg-gray-50 min-w-200"><th class="px-1 py-3 border border-gray-300 bg-gray-300 text-center cursor-pointer" style="width: 120px;">Hành động</th><th class="px-1 py-3 border border-gray-300 bg-gray-300 text-center cursor-pointer" style="width: 150px;">TÀI KHOẢN</th><th class="px-1 py-3 border border-gray-300 bg-gray-300 text-center cursor-pointer" style="width: 250px;">Chuyển tài khoản</th></tr></thead>';t.forEach((function(e,t){o+='<tr style="border: 1px solid #ddd;"><td style="text-align: center; padding: 16px;"><a style="cursor: pointer; text-decoration: underline;"><span style="padding: 4px; color: red;" class="delete-cookie" data-username="'+e.username+'" data-index="'+t+'">Xóa</span></a></td><td style="text-align: center; vertical-align: middle;"><div class="flex flex-row items-center"><img id="img_avatar" src="'+e.avatar+'" alt="User Avatar" class="w-10 h-10 rounded-full hover:cursor-pointer"><div style="margin-left: 8px;">'+e.username+'</div>  </div>          </td><td style="text-align: center;"><a data-username="'+e.username+'" class="btnChuyenDoi" data-index="'+t+'" hreft="#" style="cursor: pointer; text-decoration: underline;"><span style="color: blue;"><i class="fa fa-external-link" aria-hidden="true"></i> Chuyển đổi</span></a></td></tr>'})),o+="</table>",n.innerHTML=o,document.querySelectorAll(".btnChuyenDoi").forEach((function(e){e.addEventListener("click",(function(){var e=this.getAttribute("data-index"),t=this.getAttribute("data-username");$.confirm({title:"Thông báo!",content:'Bạn có muốn chuyển tài khoản: <span style="color: red; font-weight: bold;">'+t+"</span>?",boxWidth:"350px",useBootstrap:!1,onOpen:function(){document.body.classList.contains("dark-mode")&&this.$body.addClass("dark-mode")},buttons:{"Chuyển tài khoản":{btnClass:"btn-green",action:function(){chrome.storage.local.get({cookies:[]},(function(t){var n=t.cookies[e];chrome.runtime.sendMessage({task:"SET_COOKIE",data:n})}))}},Đóng:{btnClass:"btn-gray",action:function(){}}}})}))})),document.querySelectorAll(".delete-cookie").forEach((function(e){e.addEventListener("click",(function(){var e=this.getAttribute("data-index"),t=this.getAttribute("data-username");$.confirm({title:"Thông báo!",content:'Bạn có muốn xóa tài khoản: <span style="color: red; font-weight: bold;">'+t+"</span>?",boxWidth:"350px",useBootstrap:!1,onOpen:function(){document.body.classList.contains("dark-mode")&&this.$body.addClass("dark-mode")},buttons:{Xóa:{btnClass:"btn-red",action:function(){!function(e){chrome.storage.local.get({cookies:[]},(function(t){var n=t.cookies;n.splice(e,1),chrome.storage.local.set({cookies:n},(function(){P()}))}))}(e)}},Không:{btnClass:"btn-gray",action:function(){}}}})}))}))}else n.innerHTML="<p>Chưa có tài khoản nào.</p>"}))}function H(){setTimeout(X,200)}function X(){var e=document.querySelector("table").querySelector("tbody");if(!e)return console.log("No tbody found"),"0/0";var t=e.querySelectorAll('input[type="checkbox"]'),n=0;t.forEach((function(e){e.checked&&n++}));var o=t.length;return document.getElementById("total_item").textContent="(".concat(n,"/").concat(o,")"),n+"/"+o}function U(e){return"BEGIN:VCARD\nVERSION:3.0\nFN:".concat(e.zaloName,"\nTEL;TYPE=CELL:").concat(e.phoneNumber,"\nCATEGORIES:myContacts\nBDAY:").concat(e.sdob,"\nEND:VCARD")}$(document).ready((function(){function e(){var e=document.getElementById("countryCodeInput").value;chrome.storage.local.set({countryCode:e},(function(){console.log("Country code saved: "+e)}))}window.onload=function(){var t;t=function(e){e&&(document.getElementById("countryCodeInput").value=e)},chrome.storage.local.get(["countryCode"],(function(e){e.countryCode?(console.log("Country code found: "+e.countryCode),t(e.countryCode)):(console.log("No country code found, using default: +84"),t("+84"))})),document.getElementById("countryCodeInput").addEventListener("input",e)},chrome.storage.local.get(["userEmail","loginExpiration"],(function(e){M=e.userEmail}))})),$(document).on("click","#txtTaiKhoanEmail",(function(){var e="";$.confirm({title:'<span class="text-yellow-600 text-lg font-bold">Thông tin tài khoản</span>',boxWidth:"550px",useBootstrap:!1,content:function(){var t=this;return $.ajax({url:"https://key.laptrinhvb.net/api/get_user_info",method:"POST",data:{email:M,app_id:1}}).done((function(n){e=n.id;var o=(n.days_remaining,"bg-green-500 text-white");t.setContent('\n                  <div class="p-4 flex">\n                    <div class="flex-grow">\n                        <p class="mb-2"><strong>Email:</strong> '.concat(n.email,'</p>\n                        <p class="mb-2"><strong>Địa chỉ:</strong> ').concat(n.address,'</p>\n                        <p class="mb-2"><strong>Ngày đăng ký:</strong> ').concat(R(n.register_date),'</p>\n                        <p class="mb-2"><strong>Ngày hết hạn:</strong> ').concat(R(n.expiry_date),"</p>\n                        <p class=\"mb-2\"><strong>Gói tài khoản:</strong> <span style='color: green; font-weight: bold;'>").concat(n.license_type,'</span></p>\n                        <p class="mb-4">\n                            <strong>Số ngày còn lại:</strong> \n                            <span class="px-2 py-1 rounded ').concat(o,'">\n                                ').concat(n.days_remaining,'\n                            </span>\n                        </p>\n                        \n                        <button id="togglePasswordFields" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded mb-4">\n                            Đổi mật khẩu\n                        </button>\n                    </div>\n                    <div class="flex-shrink-0 ml-4 text-center">\n                        <img src="https://laptrinhvb.net/vietqr.png" alt="Support Admin" class="w-32 h-32 object-cover  mb-2" style="margin: 0 auto;">\n                        <p class="text-sm font-bold" style="margin-top: 8px;">Donate Support Admin</p>\n                    </div>\n                    </div>\n        \n                    <div id="passwordFields" style="display: none;">\n                        <div class="mb-4">\n                        <input type="password" id="oldPassword" placeholder="Mật khẩu cũ" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">\n                        </div>\n                        <div class="mb-4">\n                        <input type="password" id="newPassword" placeholder="Mật khẩu mới" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">\n                        </div>\n                        <button id="submitChangePassword" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded mb-4">\n                        Xác nhận đổi mật khẩu\n                        </button>\n                    </div>\n\n                    <hr class="my-4 border-t border-gray-300">\n\n                    <div class="mb-4">\n                    <p class="font-bold">Thông tin liên hệ:</p>\n                    <p>Zalo: <a href="https://zalo.me/0933913122" target="_blank">https://zalo.me/0933913122</a></p>\n                    <p>Điện thoại: +84 933.913.122</p>\n                    </div>\n\n                    <div class="mt-4">\n                    <a href="https://chrome.google.com/webstore/detail/kgbfpnnjchndjegeckjggbgcmklefman" target="_blank" class="text-blue-500 hover:underline">\n                    📌 Đánh giá tiện ích trên Chrome Web Store\n                    </a>\n                    </div>\n                  </div>\n                '))})).fail((function(){t.setContent("Lỗi khi tải thông tin người dùng.")}))},onContentReady:function(){$("#togglePasswordFields").on("click",(function(){$("#passwordFields").toggle()})),$("#submitChangePassword").on("click",(function(){toastr.options={toastClass:"toastr toastr-high-z-index"};var t=$("#oldPassword").val(),n=$("#newPassword").val();if(!t||!n)return toastr.error("Vui lòng nhập đầy đủ cả mật khẩu cũ và mới."),!1;$.ajax({url:"https://key.laptrinhvb.net/api/change_password",method:"POST",data:{id:e,old_password:t,new_password:n},success:function(e){e.success?(toastr.success("Mật khẩu đã được thay đổi thành công, vui lòng đăng nhập lại."),setTimeout((function(){chrome.storage.local.remove(["userEmail","loginExpiration"]),chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"CHANGE_PAGE",page:"../page/login.html"})}))}),3e3)):toastr.error(e.message||"Không thể thay đổi mật khẩu. Vui lòng thử lại.")},error:function(){toastr.error("Đã xảy ra lỗi khi kết nối với máy chủ. Vui lòng thử lại sau.")}})}))},buttons:{close:{text:"Đóng",btnClass:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded",action:function(){}}}})})),i.addEventListener("click",(function(){var e;chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"GET_ALL_TAG"})})),new Promise((function(e){setTimeout(e,800)})),0==$("#chkShowModal").iCheck("update")[0].checked&&$("#chkShowModal").iCheck("check"),$.confirm({title:'<span style="color: #B97902; font-size: 18px; font-weight: bold;">Chọn nội dung</span>',boxWidth:"550px",columnClass:"medium",useBootstrap:!1,content:'<div style="margin-left: 4px; margin-right: 4px; margin-bottom: 4px">\n            <div style=\'float: right;\'></select><span><b>Phân loại:</b> </span><select id="labelSelect2" class="multiple-select2" multiple style="margin-top: 6px;"> \n              \n            </select></div>\n            <div id="taskContainer" class="form-group" style="padding: 4px; clear: both;"></div>\n            <button id="btnAddContent" class="add-task-button text-base shadow-lg appearance-none border border-blue-300 rounded-lg w-full py-2 px-4 mt-2 bg-white text-blue-500 hover:bg-blue-500 hover:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">Thêm nội dung</button>\n            <div style="padding: 4px; clear: both; margin-top: 8px;">\n                <label for="delay" class="block text-sm font-medium text-gray-700">Nhập tin nhắn đính kèm: (nếu muốn)</label>\n                <textarea rows="2" class="text-base shadow-lg appearance-none border border-gray-300 rounded-lg w-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" id="txtMessageShare" placeholder="Nhập tin nhắn..." style=\'margin-top: 4px;\'></textarea>\n              \n            </div>\n            <div id="statusShare"></div>\n            </div>\n        ',onOpen:function(){document.body.classList.contains("dark-mode")&&this.$body.addClass("dark-mode")},buttons:{formSubmit:{text:"Chia sẻ",btnClass:"share-button",action:function(t){if(console.log("Button",t),!1===D){var n=function(){for(var e=document.getElementById("taskContainer").getElementsByClassName("card"),t=[],n=0;n<e.length;n++){var o=e[n].getElementsByClassName("card-content")[0];t.push({content:o.textContent.trim()})}return t}();if(n.length<=0)return toastr.error("Chưa chọn nội dung để chia sẻ, bạn ơi."),!1;t.setText("Dừng lại"),t.addClass("stop-button"),t.removeClass("share-button"),D=!0;var o=document.getElementById("txtMessageShare").value;document.getElementById("statusShare").textContent="Trạng thái: Hệ thống đang tiến hành bắt đầu share...",chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"REQUEST_SHOW_MODAL",isShowModal:!0})}));var a=e.multipleSelect("getSelects","text");chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"START_SHARE",data:n,tags:a,message:o})}))}else D=!1,toastr.info("Bạn đã yêu cầu dừng share thành công."),t.setText("Chia sẻ"),t.removeClass("stop-button"),t.addClass("share-button"),chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"STOP_SHARE",data:n})}));return!1}},close:{text:"Đóng",action:function(){}}},onContentReady:function(){var t=document.getElementById("btnAddContent");if(t.addEventListener("click",(function(){"Hủy chọn"===t.textContent?(t.textContent="Thêm nội dung",chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"HUY_CONTENT_SHARE"})})),chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"REQUEST_SHOW_MODAL",isShowModal:!0})}))):(t.textContent="Hủy chọn",chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"CHOICE_CONTENT_SHARE"})})),chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"REQUEST_SHOW_MODAL",isShowModal:!1})})))})),c){var n=document.getElementById("labelSelect2");c.forEach((function(e){if("Không có nhãn"!==e){var t=document.createElement("option");t.value=e,t.text=e,n.add(t)}}));var o=$(".multiple-select2");e=$(".multiple-select2"),o.multipleSelect({onClick:function(e){var t=o.multipleSelect("getSelects","text");console.log("option",t)}});var a=document.querySelector(".multiple-select2");a?a.style.width="100% !important":console.log('Element with class "multiple-select2" not found.'),o.multipleSelect("checkAll")}}})})),B.addEventListener("click",(function(){$.confirm({title:'<span style="color: #006EDC; font-size: 18px; font-weight: bold;">Quản lý tài khoản</span> <a id="btnCopyCookie" style="text-align: right; float: right; color: gray; font-size: 14px; margin-right: 8px;" href="#"><i class="fa fa-user-plus" aria-hidden="true"></i> Thêm tài khoản</a>',boxWidth:"550px",columnClass:"medium",useBootstrap:!1,content:'<div class="form-group" style="padding: 4px; display: none;"><textarea style="font-size: 12px;" id="txtCookie" class="phoneNumbers text-base shadow-lg appearance-none border border-gray-300 rounded-lg w-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Nhập cookie..."></textarea></div><div class="form-group" style="padding: 4px" style=""><input id="txtImage" type="hidden" /><input id="txtUsername" style="font-size: 12px;" type="hidden" class="username text-base shadow-lg appearance-none border border-gray-300 rounded-lg w-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Nhập tên người dùng..."><div style="margin-top: 10px; height: 250px;" id="tableContainer" class="table-container"></div></div>',onOpen:function(){document.body.classList.contains("dark-mode")&&this.$body.addClass("dark-mode")},buttons:{formSubmit:{text:"Cập nhật",btnClass:"btn-blue btn-add-acc",action:function(){var e,t=document.getElementById("txtCookie"),n=document.getElementById("txtUsername"),o=document.getElementById("txtImage");return console.log(t.value.trim()),""===t.value.trim()?($(t).notify("Bạn chưa nhập cookie.",{position:"bottom"}),!1):""===n.value.trim()?($(n).notify("Bạn chưa nhập tên người dùng.",{position:"top"}),!1):(e=$("#img_avatar").attr("src"),chrome.storage.local.get({cookies:[]},(function(a){var r=a.cookies,i=!1;r.forEach((function(t){t.avatar===e&&(i=!0)})),function(e){if(e)return $("#btnCopyCookie").notify("Đã tồn tại.","error",{position:"bottom"}),!1;var a,r={username:n.value.trim(),cookie:t.value.trim(),avatar:o.value.trim()};a=r,chrome.storage.local.get({cookies:[]},(function(e){var t=e.cookies;t.push(a),chrome.storage.local.set({cookies:t},(function(){P()}))})),$("#btnCopyCookie").notify("Đã thêm.","success",{position:"bottom"}),t.value="",n.value="",o.value="",P()}(i)})),!1)}},close:{text:"Đóng",action:function(){}}},onContentReady:function(){document.getElementById("btnCopyCookie").addEventListener("click",(function(){chrome.runtime.sendMessage({task:"COPY_COOKIE"})})),P()}})})),v.addEventListener("click",(function(){$.confirm({title:'<span style="color: #CA3486; font-size: 18px; font-weight: bold;">Thêm mới</span>',boxWidth:"350px",columnClass:"medium",useBootstrap:!1,content:'<div class="form-group" style="padding: 4px"><textarea id="txtListPhone" class="phoneNumbers text-base shadow-lg appearance-none border border-gray-300 rounded-lg w-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="5" placeholder="Nhập số điện thoại..."></textarea></div>',onOpen:function(){document.body.classList.contains("dark-mode")&&this.$body.addClass("dark-mode")},buttons:{formSubmit:{text:"Cập nhật",btnClass:"btn-blue",action:function(){var e=this.$content.find(".phoneNumbers").val().split("\n").filter(O);if(e.length<=0)return toastr.error("Không tìm thấy số điện thoại nào hợp lệ"),$("#txtListPhone").focus(),!1;var n=t(new Set(e)),o=[["PHONE","NAME"]].concat(t(n.map((function(e){return[e,""]}))));$("tbody").length&&$("tbody tr").each((function(){var e=$(this).find("td:nth-child(2)").text().trim();e&&!n.includes(e)&&(n.push(e),o.push([e,$(this).find("td:nth-child(3)").text().trim()||""]))})),F(o,"khách hàng")}},close:{text:"Đóng",action:function(){}}},onContentReady:function(){$("#txtListPhone").focus()}})})),k.addEventListener("click",(function(){document.getElementById("dropdown-menu").classList.toggle("hidden"),chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"EXPORT_ALL_VCARD"})}))})),E.addEventListener("click",(function(){document.getElementById("dropdown-menu").classList.toggle("hidden"),chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"EXPORT_ALL_FRIENDS"})}))})),document.getElementById("menu-button2").addEventListener("click",(function(){document.getElementById("dropdown-menu2").classList.toggle("hidden")})),document.getElementById("menu-button").addEventListener("click",(function(){document.getElementById("dropdown-menu").classList.toggle("hidden")})),document.addEventListener("click",(function(e){var t=document.getElementById("menu-button").contains(e.target),n=document.getElementById("dropdown-menu");t||n.contains(e.target)||n.classList.add("hidden")})),$("input.icheck").iCheck({checkboxClass:"icheckbox_flat-green",increaseArea:"16%"}),y.addEventListener("click",(function(){document.getElementById("dropdown-menu").classList.toggle("hidden");var e=document.querySelector(".htCore");if(!e)return toastr.error("Không có dữ liệu để xuất file, bạn ơi."),void console.error('Table with class "htCore" not found.');chrome.storage.local.get(["IS_PHAT_CODE"],(function(t){if(1==t.IS_PHAT_CODE)!function(){var e=document.querySelectorAll("tbody tr"),t="";e.forEach((function(e){var n=e.cells[1].innerText,o=e.cells[2].innerText,a=e.cells[3].innerText.includes("Đã gửi")?"OK":"ERROR";t+="".concat(n,"|").concat(o,"|").concat(a,"\n")}));var n=new Blob([t],{type:"text/plain"}),o=window.URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download="DATA_SEND_OTP_OK.txt",a.click(),window.URL.revokeObjectURL(o)}();else{var n=e.querySelectorAll("tr"),o=[];n.forEach((function(e){var t=e.querySelectorAll("td");if(t.length>=3&&"OK"===t[3].textContent.trim()){var n=t[1].textContent.trim();o.push(n)}}));var a=o.join("\n"),r=new Blob([a],{type:"text/plain"}),i=URL.createObjectURL(r),c=document.createElement("a");c.href=i,c.download="DANHSACH_PHONE_OK_ZALO.txt",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i)}}))})),b.addEventListener("click",(function(){var e=document.querySelector(".htCore"),t=[],n=[];if(document.getElementById("dropdown-menu").classList.toggle("hidden"),e.querySelectorAll("thead th").forEach((function(e){n.push(e.innerText.trim())})),n.length>0)t.push(n);else{var o=(void 0).getColHeader();t.push(o)}e.querySelectorAll("tbody tr").forEach((function(e){var n=[];e.querySelectorAll("td").forEach((function(e){n.push(e.innerText.trim())})),t.push(n)}));var a=XLSX.utils.book_new(),r=XLSX.utils.aoa_to_sheet(t);XLSX.utils.book_append_sheet(a,r,"Sheet1");var i=XLSX.write(a,{bookType:"xlsx",type:"array"});saveAs(new Blob([i],{type:"application/octet-stream"}),"zalo_data_export.xlsx")})),L.addEventListener("click",(function(){var e=L.getBoundingClientRect();I.style.height="200px",I.style.left="".concat(e.left-160,"px"),I.style.top="".concat(e.top-I.offsetHeight+window.scrollY-200,"px"),I.style.overflow="auto",$(I).toggle()})),I.addEventListener("click",(function(e){if("SPAN"===e.target.tagName){var t=e.target.textContent,n=a.selectionStart,o=a.value.substring(0,n),r=a.value.substring(n);a.value=o+t+r,a.focus(),a.selectionEnd=n+t.length}})),document.addEventListener("click",(function(e){L.contains(e.target)||I.contains(e.target)||(I.style.display="none")})),chrome.storage.local.get(["settings"],(function(e){if(e.settings){var t=e.settings.delay,n=e.settings.delay1,o=e.settings.delay2,a=e.settings.isKiemTraHopLe,r=e.settings.isKetBan;console.log("LOAD SETTINGS",e.settings);var i=a?"check":"uncheck",c=r?"check":"uncheck";$("#chkKiemTraHopLe").iCheck(i),$("#chkKetBan").iCheck(c),$("#delay").val(t),$("#delay1").val(n),$("#delay2").val(o)}})),f.addEventListener("click",(function(){$.confirm({title:"Thông báo!",content:"Bạn có muốn đăng xuất tài khoản zalo?",boxWidth:"350px",useBootstrap:!1,onOpen:function(){document.body.classList.contains("dark-mode")&&this.$body.addClass("dark-mode")},buttons:{"Đăng xuất":{btnClass:"btn-red",action:function(){chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.runtime.sendMessage({task:"LOGOUT"}),chrome.tabs.sendMessage(t,{task:"LOGOUT"})}))}},Không:{btnClass:"btn-gray",action:function(){}}}})})),p.addEventListener("click",(function(){$.confirm({title:"Thông báo!",content:"Bạn có đồng ý muốn xóa cache bộ nhớ đệm không, khi xóa xong hệ thống sẽ reload lại trang?",boxWidth:"350px",useBootstrap:!1,onOpen:function(){document.body.classList.contains("dark-mode")&&this.$body.addClass("dark-mode")},buttons:{Xóa:{btnClass:"btn-red",action:function(){chrome.storage.local.get(["tabZalo"],(function(e){var t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"XOA_CACHE"})}))}},Đóng:{btnClass:"btn-gray",action:function(){}}}})})),g.addEventListener("click",(function(){$.confirm({title:"Thông báo!",content:"Bạn có đồng ý muốn làm mới dữ liệu?",boxWidth:"350px",useBootstrap:!1,onOpen:function(){document.body.classList.contains("dark-mode")&&this.$body.addClass("dark-mode")},buttons:{"Đồng ý":{btnClass:"btn-green",action:function(){j=[],$("#fileMedia").val(""),$("#thumbnailPreview").empty(),$("#thumbnailPreview").height("0px"),$("#dataTableContainer").empty(),document.querySelectorAll("td:nth-child(4)").forEach((function(e){})),$("#txtMessage").val(""),$("#tableCount").empty(),$("#selectedItemsCount").html('Bạn đã chọn <span class="text-blue-500 font-bold">0</span> tập tin.'),chrome.storage.local.set({DanhSach:[]})}},Không:{btnClass:"btn-red",action:function(){}}}})})),chrome.runtime.onMessage.addListener((function(e,t,n){if(console.log(e),"USER_INFO"===e.task){var o=e.data;$("#txtusername_zalo").text(o.name),$("#img_avatar").attr("src",o.avatarUrl),console.log("POPUP USERINFO",o)}if("COOKIES_COPIED"===e.task){var a=document.getElementById("txtCookie"),i=document.getElementById("txtUsername"),s=document.getElementById("txtImage");if(i){i.value=$("#txtusername_zalo").text(),s&&(s.value=$("#img_avatar").attr("src")),a.value=e.data;var u=document.querySelector(".btn-add-acc");u&&u.click()}}if("TRANGTHAI_SHARE"===e.task&&(document.getElementById("statusShare").textContent=e.message),"CHON_XONG_NOIDUNG"==e.task){var h=e.data,m=document.getElementById("taskContainer");document.getElementById("btnAddContent").textContent="Thêm nội dung";var g=document.createElement("div");g.className="card";var p=document.createElement("div");p.className="card-content",p.textContent=h;var f=document.createElement("button");f.className="clear-button",f.textContent="Xóa",f.style.display="none",g.addEventListener("mouseover",(function(){f.style.display="block"})),g.addEventListener("mouseout",(function(){f.style.display="none"})),f.addEventListener("click",(function(){g.remove()})),g.appendChild(p),g.appendChild(f),m.appendChild(g)}if("FINISH_SEND_MESSAGE"===e.task&&(r.style.display="block",l.style.display="none",toastr.success("Đã thực hiện nghiệp vụ hoàn tất, bạn ơi.")),"CURRENT_PROCESSING_ITEM"===e.task){var b=e.data;l.textContent="Dừng gởi",document.getElementById("total_item").textContent="".concat(b)}if("PROCESSING_ITEM"===e.task&&d((b=e.data)[0],"Đang gởi...",0,"#eb2f96"),"SLEEP_COUNT_DOWN"===e.task){var y=e.countdown,v=e.item;-1==y?d(v[0],"Hệ thống dừng gởi tin...",0,"#262626"):d(v[0],"Chờ xử lý (".concat(y,")"),0,"#cf1322")}if("TRANGTHAI_SEND_MESSAGE"===e.task&&(b=e.data,$("#chkKiemTraHopLe").iCheck("update")[0].checked?"ok"==b.status?(d(b.phone.phone,b.message,0,"#389e0d"),function(e,t,n,o){for(var a=document.querySelector(".htCore").querySelectorAll("tbody tr"),r=0;r<a.length;r++){var i=a[r],c=i.querySelector("td:nth-child(2)");if(c&&c.textContent.trim()===e){var l=i.querySelector("td:nth-child(3)");if(l)return l.textContent=t,void(l.style.color="#eb2f96")}}}(b.phone.phone,b.phone.username)):"block"==b.status?(d(b.phone,b.message,0,"#ff7875"),l.click()):d(b.phone,b.message,0,"#434343"):"ok"==b.status?d(b.phone,b.message,0,"#389e0d"):"block"==b.status?(d(b.phone,b.message,0,"#ff7875"),l.click()):d(b.phone,b.message,0,"#434343")),"DATA_LIST_TAGS"===e.task){var x=e.friends.filter((function(e){return[0,1,2].includes(e.type)}));x.map((function(e){return[e.userId,e.displayName]})).sort((function(e,t){return e[1].localeCompare(t[1])})).unshift(["UID","Name"]);var k=new Set;x.forEach((function(e){k.add(e.tag)})),c=Array.from(k)}if("DATA_LIST_FRIEND_RECEIVED_EXPORT"===e.task&&function(e,t){var n=XLSX.utils.json_to_sheet(e),o=XLSX.utils.book_new();XLSX.utils.book_append_sheet(o,n,"Friends"),XLSX.writeFile(o,"".concat("ZALO_FRIENDS_ALL",".xlsx"))}(e.friends),"DATA_LIST_FRIEND_VCARD_EXPORT"===e.task&&function(e,t){var n=e.filter((function(e){return e.phoneNumber}));console.log("JSON FILTER",n);var o=n.map(U).join("\n"),a=new Blob([o],{type:"text/vcard"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download="".concat("ZALO_CONTACT_VCARD",".vcf"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}(e.friends),"DATA_LIST_FRIEND_RECEIVED"===e.task){var E=function(e){e=e.toLowerCase();for(var t=0;t<67;t++)e=e.replace(new RegExp("àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđ"[t],"gi"),"aaaaaaaaaaaaaaaaaeeeeeeeeeeeiiiiiooooooooooooooooouuuuuuuuuuuyyyyyd"[t]);return e.replace(/\s/g,"").trim()},C=e.friends.filter((function(e){return[0,1,2].includes(e.type)})),S=C.map((function(e){return[e.userId,e.displayName]})).sort((function(e,t){return e[1].localeCompare(t[1])}));S.unshift(["UID","Name"]),$("#tableCount").html('Bạn đã chọn <span class="text-blue-500 font-bold" id="total_item">'.concat(S.length-1,'</span> bạn bè.  <select id="labelSelect" class="multiple-select" multiple style="margin-top: 6px;"> \n              \n            </select>\n              <div style="position: relative; float: right;">\n                    <input type="text" id="searchInput" placeholder="Tìm kiếm..." class="w-full px-3 py-1 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="margin-top: -2px;">\n                    </div>\n            \n            ')),document.getElementById("searchInput").addEventListener("input",(function(){var e=document.getElementById("searchInput"),t=E(e.value),n=document.querySelector("#dataTableContainer table"),o=n.getElementsByTagName("tr"),a=0,r=n.querySelector(".no-data-row");r&&r.remove(),console.log("Name: ",t);for(var i=1;i<o.length;i++){var c=o[i].getElementsByTagName("td")[2];c&&(E(c.textContent).indexOf(t)>-1?(o[i].style.display="",a++):o[i].style.display="none")}if(0===a){var l=n.insertRow();l.className="no-data-row";var s=l.insertCell(0);s.colSpan=4,s.textContent="Không tìm thấy dữ liệu...",s.style.textAlign="center",s.style.padding="10px",s.style.width="800px",s.style.color="red",s.style.fontWeight="bold",s.style.border="1px solid gray"}}));var w=document.getElementById("searchInput"),L=document.createElement("button");L.textContent="✕",L.className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",L.addEventListener("click",(function(){document.getElementById("searchInput").value="";for(var e=document.querySelector("#dataTableContainer table").getElementsByTagName("tr"),t=1;t<e.length;t++)e[t].style.display=""}));var I=document.createElement("div");I.className="relative",w.parentNode.insertBefore(I,w),I.appendChild(w),I.appendChild(L);var _=new Set;C.forEach((function(e){_.add(e.tag)})),distinctLabelsArray=Array.from(_);var T=document.getElementById("labelSelect");distinctLabelsArray.forEach((function(e){var t=document.createElement("option");t.value=e,t.text=e,T.add(t)}));var A=$(".multiple-select");A.multipleSelect({onCheckAll:function(){var e=A.multipleSelect("getSelects","text");console.log("option",e);var t=C.filter((function(t){return 0===e.length||e.includes(t.tag)})).map((function(e){return[e.userId,e.displayName]})).sort((function(e,t){return e[1].localeCompare(t[1])}));t.unshift(["UID","Name"]),$("#total_item").text(t.length-1+""),F(t,"bạn bè")},onUncheckAll:function(){var e=[];e.unshift(["UID","Name"]),$("#total_item").text("0"),F(e,"bạn bè")},onClick:function(e){var t=A.multipleSelect("getSelects","text");console.log("option",t);var n=C.filter((function(e){if(0===t.length){var n=[];return n.unshift(["UID","Name"]),$("#total_item").text("0"),void F(n,"bạn bè")}return t.includes(e.tag)})),o=n.map((function(e){return[e.userId,e.displayName]})).sort((function(e,t){return e[1].localeCompare(t[1])}));o.unshift(["UID","Name"]),$("#total_item").text(o.length-1+""),F(o,"bạn bè")}}),A.multipleSelect("checkAll")}}));var j=[],q=0===$("#frameMain_th").width();function K(){var e={delay:$("#delay").val(),delay1:$("#delay1").val(),delay2:$("#delay2").val(),isKiemTraHopLe:$("#chkKiemTraHopLe").iCheck("update")[0].checked,isKetBan:$("#chkKetBan").iCheck("update")[0].checked};chrome.storage.local.set({settings:e}),console.log("SAVE SETTINGS SUCCESSFUL.",e)}function Z(){var e,t=document.getElementById("thumbnailPreview");document.getElementById("selectedItemsCount"),t.innerHTML="",e=j.length,document.getElementById("selectedItemsCount").innerHTML='Bạn đã chọn <span class="text-blue-500 font-bold">'.concat(e,"</span> tập tin.");var n={"application/pdf":"📘","application/vnd.ms-excel":"📊","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"📊"};function o(e,t){var n=e.slice(e.lastIndexOf(".")),o=e.slice(0,e.lastIndexOf("."));return o.length+n.length>=t?e:o.slice(0,t-n.length-3)+"..."+n}j.length>0?$("#thumbnailPreview").height("155px"):$("#thumbnailPreview").height("0px"),j.forEach((function(e,a){var r=e.type,i=document.createElement("div");i.className="thumbnail-container w-24 m-2 flex flex-col items-center",i.dataset.index=a;var c=document.createElement("button");if(c.className="delete-button",c.textContent="❌",c.addEventListener("click",(function(){!function(e){j.splice(e,1);var t=new DataTransfer;j.forEach((function(e){return t.items.add(e)})),w.files=t.files,Z()}(a)})),i.appendChild(c),r.startsWith("image/")){var l=new FileReader;l.onload=function(t){var n=document.createElement("img");n.src=t.target.result,n.className="w-full h-24 object-cover border border-gray-300 rounded-md shadow-md",i.appendChild(n);var a=document.createElement("span");a.className="mt-1 text-center text-xs truncate w-full",a.textContent=o(e.name,10),i.appendChild(a)},l.readAsDataURL(e)}else{var s=n[r]||"📑",d=document.createElement("div");d.className="w-full h-24 flex items-center justify-center border border-gray-300 rounded-md shadow-md text-4xl",d.textContent=s,i.appendChild(d);var u=document.createElement("span");u.className="mt-1 text-center text-xs truncate w-full",u.textContent=o(e.name,10),i.appendChild(u)}t.appendChild(i)}))}function F(e,t){chrome.storage.local.set({DanhSach:e,type:t}),console.log("displayExcel",e);var n=e[0].concat("Trạng Thái");e.forEach((function(e){e.push("")})),"khách hàng"===t&&$("#tableCount").html('Bạn đã chọn <span class="text-blue-500 font-bold" id="total_item">'.concat(e.length-1,"</span> ").concat(t,"."));var o=document.getElementById("dataTableContainer");o.innerHTML="";var a=document.createElement("table");a.className="table table-striped table-bordered htCore w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400  w-screen";var r=document.createElement("thead");r.className="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 sticky top-0";var i=document.createElement("tr"),c=document.createElement("th");(d=document.createElement("input")).type="checkbox",d.addEventListener("change",(function(){H()})),d.className="form-checkbox h-4 w-4 text-green-600 cursor-pointer transition duration-150 ease-in-out hover:text-green-500",c.className="px-1 py-3 border border-gray-300 bg-gray-300 text-center cursor-pointer",c.appendChild(d),i.appendChild(c),n.forEach((function(e){var t=document.createElement("th");t.className="px-1 py-3 border border-gray-300 bg-gray-300",t.textContent=e,i.appendChild(t)})),r.appendChild(i),a.appendChild(r);var l=document.createElement("tbody");l.className="h-25 overflow-y-auto";for(var s=1;s<e.length;s++){(i=document.createElement("tr")).addEventListener("click",(function(){H()})),i.className="border dark:bg-gray-300 darkborder-gray-700 hover:bg-gray-50 min-w-200";var d,u=0,h=document.createElement("td");h.addEventListener("click",(function(){H()})),(d=document.createElement("input")).type="checkbox",d.addEventListener("change",(function(){H()})),d.className="mt-1 form-checkbox h-4 w-4 text-green-600 cursor-pointer transition duration-150 ease-in-out hover:text-green-500",h.className="border border-gray-300 px-1 text-center cursor-pointer",h.style.width="55px",h.appendChild(d),i.appendChild(h),e[s].forEach((function(e){if(!(u>1)){var t=document.createElement("td");t.className="border border-gray-300 px-1",t.textContent=e,t.style.width="200px",i.appendChild(t),u++}}));var m=document.createElement("td");m.style.width="350px",m.className="border border-gray-300",i.appendChild(m),l.appendChild(i)}a.appendChild(l),o.appendChild(a),$("table").simpleCheckboxTable()}chrome.storage.local.set({DanhSach:[],isShowApp:q}),$(".btngetfriend_nhom").on("click",(function(){document.getElementById("dropdown-menu2").classList.toggle("hidden");var e=$(this).attr("data-option");chrome.storage.local.get(["tabZalo"],(function(t){var n=t.tabZalo.id;chrome.tabs.sendMessage(n,{task:"GET_ALL_FRIENDS",option:e})}))})),$("#delay, #delay1, #delay2").on("change",K),$("#chkKetBan").on("ifChanged",(function(e){K()})),$("#chkKiemTraHopLe").on("ifChanged",(function(e){K()})),$("#chkShowModal").on("ifChanged",(function(e){var t=$("#chkShowModal").iCheck("update")[0].checked;t?toastr.info("Đã bật show modal thành công, bạn ơi."):toastr.error("Đã tắt ẩn show modal, bạn ơi."),chrome.storage.local.get(["tabZalo"],(function(e){var n=e.tabZalo.id;chrome.tabs.sendMessage(n,{task:"REQUEST_SHOW_MODAL",isShowModal:t})}))})),$("#chkAutoScroll").on("ifChanged",(function(e){$("#chkAutoScroll").iCheck("update")[0].checked?toastr.info("Đã bật chế độ tự động cuộn, bạn ơi."):toastr.error("Đã tắt chế độ tự động cuộn, bạn ơi.")})),r.addEventListener("click",(function(){var e=function(){var e=document.querySelector("table");if(!e)return[];var t=e.querySelector("tbody");if(!t)return console.log("No tbody found"),[];var n=t.querySelectorAll("tr"),o=[];return n.forEach((function(e){var t=e.querySelector('td:nth-child(1) input[type="checkbox"]');if(t&&t.checked){var n=[e.querySelector("td:nth-child(2)").textContent,e.querySelector("td:nth-child(3)").textContent];o.push(n)}})),console.log(JSON.stringify(o)),o}(),t=0;if($("thead").length&&$("thead th:nth-child(3)").each((function(){var e=$(this).text().trim();console.log("Header text from second column: "+e),"nội dung"==e.toLowerCase()&&(t=1)})),0!==e.length){chrome.storage.local.set({DanhSach:e});var n=$("#delay").val(),o=$("#delay1").val(),i=$("#delay2").val();if(""==n.trim()||Number(n)<=0)return toastr.error("Thông số nhập cấu hình không hợp lệ, không phải số, hoặc < 0, em trai."),void $("#delay").focus();if(""==o.trim()||Number(o)<=0)return toastr.error("Thông số nhập cấu hình không hợp lệ, không phải số, hoặc < 0, em trai."),void $("#delay1").focus();if(""==i.trim()||Number(i)<=0)return toastr.error("Thông số nhập cấu hình không hợp lệ, không phải số, hoặc < 0, em trai."),void $("#delay2").focus();K(),chrome.storage.local.set({IS_PHAT_CODE:t}),document.querySelectorAll("td:nth-child(4)").forEach((function(e){}));var c=$("#chkKetBan").iCheck("update")[0].checked,s=$("#chkKiemTraHopLe").iCheck("update")[0].checked;c&&s?toastr.error("Vui lòng chỉ chọn 1 trong 2 chức năng kiểm tra số điện thoại hoặc kêt bạn."):chrome.storage.local.get("DanhSach",(function(e){if(0!=e.DanhSach.length){console.log("danhsachkh:",e);var n=e.DanhSach,o=a.value,i=$("#chkKiemTraHopLe").iCheck("update")[0].checked,c=$("#chkKetBan").iCheck("update")[0].checked;if(console.log("IS_PHAT_CODE",t),!1===i&&!1===c&&0===t&&0==o.length)return toastr.error("Chưa nhập nội dung tin nhắn, bạn ơi."),void a.focus();var s=w.files;console.log("files chosen from popup: ",s),r.style.display="none",l.style.display="block";var d=$("#tableCount").text().includes("bạn bè")?"BAN_BE":"KHACH_HANG",u=(e={phone:n,message:o},[]);s.length>0?Array.from(s).forEach((function(t){var n=new FileReader;n.onload=function(){u.push({fileData:n.result,fileName:t.name}),u.length===s.length&&chrome.runtime.sendMessage({task:"SEND_MESSAGE_TO_FRIENDS",data:e,files:u,type:d})},n.readAsDataURL(t)})):chrome.runtime.sendMessage({task:"SEND_MESSAGE_TO_FRIENDS",data:e,files:[],type:d}),console.log("file list",u),document.querySelectorAll(".htCore tbody tr td:nth-child(4)").forEach((function(e){e.textContent=""}))}else toastr.error("Bạn chưa chọn danh sách để gởi tin nhắn.")}))}else toastr.error("Bạn chưa chọn danh sách để thực hiện.")})),l.addEventListener("click",(function(){r.style.display="block",l.style.display="none",toastr.success("Đã dừng thực hiện thành công, bạn ơi."),chrome.runtime.sendMessage({task:"stop_send_message"})})),x.addEventListener("click",(function(){S.click()})),C.addEventListener("click",(function(){w.click()})),w.addEventListener("change",(function(e){j=Array.from(e.target.files),Z()})),S.addEventListener("change",(function(e){var n=e.target.files[0],o=new FileReader;if(n){var a=n.name.split(".").pop().toLowerCase();o.onload=function(e){var n=e.target.result;if("txt"===a)n.includes("|")?function(e){console.log("OTP",e);var n=e.split("\n").map((function(e){var t=e.split("|").map((function(e){return e.trim()}));return 2===t.length&&t[1].length>0?t:null})).filter((function(e){return null!==e})),o=new Set;n=n.filter((function(e){var t=e[0];return!o.has(t)&&(o.add(t),!0)})),F([["Phone","Nội dung"]].concat(t(n)),"khách hàng")}(n):function(e){var n=e.split("\n").map((function(e){return e.split(",").map((function(e){return e.trim()}))})).filter((function(e){return e.length>0&&e.some((function(e){return e.length>0}))})),o=new Set;n=n.filter((function(e){if(e.length>0){var t=e[0];return!o.has(t)&&(o.add(t),!0)}return!1})),F([["Phone","Name"]].concat(t(n)),"khách hàng")}(n);else if("xlsx"===a){var o=XLSX.read(new Uint8Array(n),{type:"array"}),r=o.SheetNames[0],i=o.Sheets[r];"nội dung"==XLSX.utils.sheet_to_json(i,{header:1})[0][1].trim().toLowerCase()?function(e){var n=XLSX.read(new Uint8Array(e),{type:"array"}),o=n.SheetNames[0],a=n.Sheets[o],r=XLSX.utils.sheet_to_json(a,{header:1}),i=new Set;F(t(r=r.filter((function(e){return e.length>=2&&e[1].trim().length>0&&(e[0]=String(e[0]).trim(),!i.has(e[0])&&(i.add(e[0]),!0))}))),"khách hàng")}(n):function(e){var t=XLSX.read(new Uint8Array(e),{type:"array"}),n=t.SheetNames[0],o=t.Sheets[n],a=XLSX.utils.sheet_to_json(o,{header:1}),r=new Set;(a=a.filter((function(e){return e.length>0&&(e[0]=String(e[0]).trim(),!r.has(e[0])&&(r.add(e[0]),!0))}))).map((function(e){return{phoneNumber:e[0]}})),F(a,"khách hàng")}(n)}},"txt"===a?o.readAsText(n):"xlsx"===a&&o.readAsArrayBuffer(n),S.value=""}}))}))})();